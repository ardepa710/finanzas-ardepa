generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum TipoCredito {
  PRESTAMO
  TARJETA
}

enum FrecuenciaPago {
  SEMANAL
  QUINCENAL
  MENSUAL
}

enum TipoCategoria {
  GASTO
  INGRESO
}

enum FuenteGasto {
  TELEGRAM
  WEB
}

enum PeriodoPresupuesto {
  SEMANAL
  QUINCENAL
  MENSUAL
}

model Categoria {
  id          String        @id @default(cuid())
  nombre      String
  icono       String
  color       String
  tipo        TipoCategoria
  activa      Boolean       @default(true)
  orden       Int

  parentId    String?
  parent      Categoria?    @relation("SubCategorias", fields: [parentId], references: [id])
  hijos       Categoria[]   @relation("SubCategorias")

  gastos       Gasto[]
  gastosFijos  GastoFijo[]
  presupuestos Presupuesto[]

  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@unique([nombre, tipo])
  @@index([activa])
}

model Credito {
  id          String         @id @default(cuid())
  nombre      String
  tipo        TipoCredito
  montoTotal  Decimal        @db.Decimal(10, 2)
  saldoActual Decimal        @db.Decimal(10, 2)
  pagoMensual Decimal        @db.Decimal(10, 2)
  pagoMinimo  Decimal?       @db.Decimal(10, 2)
  fechaCorte  Int?
  diaPago     Int
  tasaInteres Decimal?       @db.Decimal(5, 2)
  activo      Boolean        @default(true)
  frecuencia  FrecuenciaPago @default(MENSUAL)
  diaSemana   Int?
  fechaBase   DateTime?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
}

model Gasto {
  id          String      @id @default(cuid())
  descripcion String
  monto       Decimal     @db.Decimal(10, 2)
  categoriaId String
  categoria   Categoria   @relation(fields: [categoriaId], references: [id])
  fecha       DateTime    @default(now())
  fuente      FuenteGasto @default(WEB)
  createdAt   DateTime    @default(now())

  @@index([categoriaId, fecha])
}

model FuenteIngreso {
  id         String         @id @default(cuid())
  nombre     String
  monto      Decimal        @db.Decimal(10, 2)
  frecuencia FrecuenciaPago
  diaSemana  Int?
  diaMes     Int?
  fechaBase  DateTime
  activo     Boolean        @default(true)
  createdAt  DateTime       @default(now())
  ingresos   IngresoManual[]

  @@index([activo])
}

model IngresoManual {
  id          String         @id @default(cuid())
  monto       Decimal        @db.Decimal(10, 2)
  fecha       DateTime       @default(now())
  descripcion String?
  fuenteId    String?
  fuente      FuenteIngreso? @relation(fields: [fuenteId], references: [id])
  createdAt   DateTime       @default(now())

  @@index([fuenteId])
  @@index([fecha])
}

model GastoFijo {
  id          String         @id @default(cuid())
  nombre      String
  monto       Decimal        @db.Decimal(10, 2)
  categoriaId String
  categoria   Categoria      @relation(fields: [categoriaId], references: [id])
  frecuencia  FrecuenciaPago
  diaSemana   Int?
  diaMes      Int?
  fechaBase   DateTime
  activo      Boolean        @default(true)
  lastApplied DateTime?
  createdAt   DateTime       @default(now())

  @@index([activo])
  @@index([categoriaId])
}

model Presupuesto {
  id           String              @id @default(cuid())
  categoriaId  String
  categoria    Categoria           @relation(fields: [categoriaId], references: [id])

  monto        Decimal             @db.Decimal(10, 2)
  periodo      PeriodoPresupuesto

  alertaEn80   Boolean             @default(true)
  alertaEn90   Boolean             @default(true)
  alertaEn100  Boolean             @default(true)

  activo       Boolean             @default(true)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  @@unique([categoriaId, periodo])
  @@index([activo])
}
